{"version":3,"sources":["webpack:///src/app/_3D/engines/client-editor.engine.ts","webpack:///src/app/_3D/libs/project-editor.ts"],"names":["ClientEditorEngine","uses","data","options","Mesh","Geometry","Material","Light","Composer","Shadows","inited","$controlEngine","setData","composer","lights","addLights","models","addModels","meshes","addMeshes","objects","addObjects","emit","grids","addGrids","cameras","addCameras","floor","addFloor","controls","addControls","updateSettings","constructor","Loader","self","focusIn","on","e","canChangeCamera","document","addEventListener","controlEngine","refresh","renew","type","scene","updateSceneSettings","background","setBackground","updateSceneFloorSetting","size","shadow","updateShadowSettings","control","updateControlSettings","camera","updateMainCameraSettings","reset","data_","resetObjects","resetLights","startup","shadows","initScene","setMainCamera","createRenderer","renderer","enabled","updateProjectionMatrix","setMainControl","ready","autoRenderStatus","setTimeout","render","setControlEngine","setMainEngine","changeCameraByControlEngine","mainPosition","position","ctrlPosition","mainX","x","mainY","y","mainZ","z","ctrlX","ctrlY","ctrlZ","mainDistance","Math","sqrt","pow","ctrlDistance","ratio","lookAt","highPerformance","controlCanTurnOffShadow","startDeactiveShadowTimer","Editor__","app","engine","lightHelperStatus","setup","startup2","scope","onDblClick","event","rect","wrapper","getBoundingClientRect","onDownPosition","clientX","left","clientY","top","pointer","width","height","detectObj","selectMeshByPointer","mesh","ProjectEditor"],"mappings":"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","file":"common-es5.js","sourcesContent":["import createClass from '@app/_core/helpers/es5.class';\r\nimport { assignValue, isArray, isEmpty, isNumber, isObject, isString } from '@app/_core/helpers/utils';\r\n\r\n\r\nimport Scene from '../traits/scene';\r\nimport Camera from '../traits/camera';\r\nimport Renderer from '../traits/renderer';\r\nimport Controls from '../traits/controls';\r\nimport GridHelper from '../traits/grid-helper';\r\nimport Lights from '../traits/lights';\r\nimport ObjectManager from '../traits/object-manager';\r\nimport {EventDispatcher} from '../libs/event-dispatcher';\r\n\r\nimport { Geometries, LightLib, LoaderLib, Materials, Meshes } from '../libs/three.libs';\r\n\r\nimport Models from '../libs/models';\r\n\r\n\r\nimport Loader from '../modules/loader'\r\nimport Composer from '../modules/composer'\r\nimport DynamicShadows from '../modules/dynamic-shadows'\r\nimport { EngineClass, EngineInstance } from './engine.doc';\r\nimport { Floor } from '../traits/floor';\r\n\r\nexport interface EditorEngineInstance extends EngineInstance {\r\n    setData(data:any): any\r\n\r\n}\r\nexport interface EditorEngineClass extends EngineClass {\r\n    setData(data:any): any\r\n    new(data: any): EditorEngineInstance\r\n    (data:any): EditorEngineInstance\r\n}\r\n\r\n\r\nconst ClientEditorEngine = createClass(\"ClientEditorEngine\").uses(\r\n    Scene, \r\n    Camera, \r\n    Renderer, \r\n    Controls, \r\n    Models, \r\n    Lights, \r\n    ObjectManager, \r\n    Floor,\r\n    EventDispatcher, \r\n    GridHelper\r\n)({\r\n    data: {},\r\n    options: {},\r\n\r\n    Mesh: {},\r\n    Geometry: {},\r\n    Material: {},\r\n    Light: {},\r\n    Composer: {},\r\n    Shadows: {},\r\n    inited: false,\r\n    $controlEngine: null,\r\n\r\n    setData: function(data?:any){\r\n        if (data.composer && !isEmpty(data.composer)) {\r\n            this.composer = new Composer(this, data.composer);\r\n        }\r\n        if (data.lights && isArray(data.lights)) {\r\n            this.addLights(data.lights);\r\n        }\r\n        if (data.models && isArray(data.models)) {\r\n            this.addModels(data.models);\r\n        }\r\n        if (data.meshes && isArray(data.meshes)) {\r\n            this.addMeshes(data.meshes);\r\n        }\r\n        if (data.objects && (isArray(data.objects) || isObject(data.objects))) {\r\n            this.addObjects(data.objects);\r\n        }else{\r\n            this.emit(\"object.load.completed\");\r\n        }\r\n        if (data.grids && isArray(data.grids)) {\r\n            this.addGrids(data.grids);\r\n        }\r\n        if (data.cameras && isArray(data.cameras)) {\r\n            this.addCameras(data.cameras);\r\n        }\r\n        if (data.floor && isArray(data.floor)) {\r\n            this.addFloor(data.floor);\r\n        }\r\n        if (data.controls && isArray(data.controls)) {\r\n            this.addControls(data.controls);\r\n        }\r\n        this.updateSettings();\r\n        this.emit('setdata', data);\r\n        \r\n        \r\n    },\r\n\r\n    /**\r\n     * Hàm khởi tạo\r\n     * @param {Dom} viewport \r\n     * @param {*} data \r\n     */\r\n    constructor: function (data?:any) {\r\n        if (data && isObject(data)) {\r\n            this.data = data;\r\n        }\r\n        this.Geometry = Geometries;\r\n        this.Material = Materials;\r\n        this.Mesh = Meshes;\r\n        this.Light = LightLib;\r\n        this.Loader = new Loader(this);\r\n        \r\n        \r\n        var self = this;\r\n        \r\n        var focusIn = false;\r\n        this.on('pointerdown', function(e){\r\n            self.canChangeCamera = false\r\n            focusIn = true;\r\n        }, false)\r\n        document.addEventListener('pointerup', function(e){\r\n            if(focusIn){\r\n                self.canChangeCamera = true\r\n                focusIn = false;\r\n            }\r\n            \r\n        }, false);\r\n\r\n        this.on(\"object.added\", function(e){\r\n            if(isObject(self.controlEngine) && self.controlEngine.refresh){\r\n                self.controlEngine.refresh();\r\n            }\r\n        })\r\n    },\r\n\r\n    renew: function(data){\r\n        this.data = assignValue({}, data);\r\n        this.inited = false;\r\n        this.emit({\r\n            type: \"renew\"\r\n        })\r\n    },\r\n\r\n    updateSettings: function(){\r\n        if (this.data) {\r\n            var data = this.data;\r\n            if (isObject(data.scene)) {\r\n                var scene = data.scene;\r\n                this.updateSceneSettings(scene);\r\n                if (isObject(scene.background) && !isEmpty(scene.background))\r\n                    this.setBackground(scene.background);\r\n                if (isObject(scene.floor) && !isEmpty(scene.floor))\r\n                    this.updateSceneFloorSetting(scene.floor);\r\n                if (isObject(scene.size) && !isEmpty(scene.size))\r\n                    this.updateSceneSettings(scene.size);\r\n            }\r\n            if(isObject(data.shadow))\r\n                this.updateShadowSettings(data.shadow);\r\n            if(isObject(data.control))\r\n                this.updateControlSettings(data.control);\r\n            if(isObject(data.camera))\r\n                this.updateMainCameraSettings(data.camera, true);\r\n        }\r\n\r\n    },\r\n\r\n    reset: function (data_) {\r\n        if (isObject(data_)) this.data = assignValue({}, data_);\r\n        this.resetObjects();\r\n        this.resetLights();\r\n\r\n        this.updateSettings();   \r\n        this.setData(this.data);\r\n\r\n        this.emit({\r\n            type: \"reset\"\r\n        })\r\n    },\r\n\r\n\r\n    startup: function startup( data?:any) {\r\n        if (this.inited) return this;\r\n\r\n\r\n        if (data && isObject(data)) {\r\n            this.data = data;\r\n        }\r\n        this.Shadows = new DynamicShadows(this, this.data.shadow || this.data.shadows || {});\r\n        this.emit('startup', this.data);\r\n\r\n        this.initScene(this.data.scene || {});\r\n        this.setMainCamera(this.data.camera || {});\r\n        this.createRenderer(this.data.renderer || {}, this.data.shadow?this.data.shadow.enabled:true);\r\n        \r\n        this.camera.updateProjectionMatrix();\r\n        this.setMainControl(this.data.control || {});\r\n\r\n        this.updateSettings();\r\n        var self = this;\r\n        this.inited = true;\r\n        // this.Shadows.init();\r\n        self.ready();\r\n        if (!this.autoRenderStatus) {\r\n            setTimeout(function () {\r\n                self.render();\r\n            }, 500);\r\n        }\r\n    \r\n        \r\n        return this;\r\n\r\n    },\r\n    \r\n    canChangeCamera: true,\r\n\r\n    setControlEngine: function(controlEngine){\r\n        if(!isObject(controlEngine)||this.controlEngine == controlEngine) return false;\r\n        this.controlEngine = controlEngine;\r\n        controlEngine.setMainEngine(this);\r\n        var self = this;\r\n        controlEngine.on(\"controls.change.camera\", function(e){\r\n            self.changeCameraByControlEngine(e.camera);\r\n        });\r\n        controlEngine.refresh();\r\n        setTimeout(() => {\r\n            controlEngine.refresh();\r\n        }, 10000);\r\n    },\r\n    changeCameraByControlEngine: function(camera){\r\n        if(this.canChangeCamera){\r\n            var mainPosition = this.camera.position;\r\n            var ctrlPosition = camera.position;\r\n            var mainX = mainPosition.x, mainY = mainPosition.y, mainZ = mainPosition.z;\r\n            var ctrlX = ctrlPosition.x, ctrlY = ctrlPosition.y, ctrlZ = ctrlPosition.z;\r\n            var mainDistance = Math.sqrt(\r\n                Math.pow(mainX, 2) + Math.pow(mainY, 2) + Math.pow(mainZ, 2)\r\n            );\r\n            var ctrlDistance = Math.sqrt(\r\n                Math.pow(ctrlX, 2) + Math.pow(ctrlY, 2) + Math.pow(ctrlZ, 2)\r\n            );\r\n            var ratio = mainDistance / ctrlDistance;\r\n            \r\n            mainPosition.x = ctrlPosition.x*ratio;\r\n            mainPosition.y = ctrlPosition.y*ratio;\r\n            mainPosition.z = ctrlPosition.z*ratio;\r\n            this.camera.lookAt(0, 0, 0);\r\n            if (this.control.highPerformance && this.controlCanTurnOffShadow) {\r\n                \r\n                this.startDeactiveShadowTimer(500, \"control\");\r\n            }\r\n            this.refresh();\r\n\r\n        }\r\n    }\r\n}) as EditorEngineClass\r\nexport default ClientEditorEngine;\r\nexport {ClientEditorEngine};\r\n","import { getTimeStamp } from '@app/_core/helpers/utils';\r\nimport * as THREE from 'three';\r\nimport { _class } from '@app/_core/helpers/es5.class';\r\nimport { EventDispatcher } from './event-dispatcher';\r\nimport { EditorClass, iEditor } from '../store/docs';\r\nimport ClientEditor from './client-editor';\r\nimport { ItemEditorService } from '../services/item-editor.service';\r\nimport { EngineClass, EngineInstance } from '../engines/engine.doc';\r\nimport { ProjectEditorService } from '../services/project-editor.service';\r\n\r\nexport interface ProjectEditorInstance extends iEditor{\r\n    app: ProjectEditorService\r\n}\r\n\r\nexport interface ProjectEditor extends EditorClass{\r\n    new(app: ProjectEditorService, engine: EngineInstance): ProjectEditorInstance\r\n}\r\n\r\nconst Editor__: any = _class(\"ProjectEditor\").extends(ClientEditor).uses(EventDispatcher)({\r\n        \r\n    constructor: function constructor(app, engine: any) {\r\n        this.lightHelperStatus = false;\r\n        this.setup(app, engine);\r\n        this.startup2();\r\n    },\r\n\r\n    startup2: function () {\r\n        var scope = this;\r\n\r\n        this.on(\"dbclick\", onDblClick);\r\n\r\n        function onDblClick(event) {\r\n            var rect = scope.engine.wrapper.getBoundingClientRect();\r\n            scope.onDownPosition.x = event.clientX - rect.left;\r\n            scope.onDownPosition.y = event.clientY - rect.top;\r\n            const pointer = new THREE.Vector2();\r\n            pointer.x = (scope.onDownPosition.x / rect.width) * 2 - 1;\r\n            pointer.y = - (scope.onDownPosition.y / rect.height) * 2 + 1;\r\n            const detectObj = scope.selectMeshByPointer(pointer);\r\n            if (detectObj) {\r\n                scope.emit({\r\n                    type: \"select:mesh\",\r\n                    mesh: detectObj\r\n                });\r\n\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\n\r\n\r\nexport const ProjectEditor = Editor__ as ProjectEditor;\r\n\r\nexport default ProjectEditor;"]}