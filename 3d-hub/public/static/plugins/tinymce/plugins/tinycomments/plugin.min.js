/* Tiny Comments plugin
*
* Copyright 2010-2020 Tiny Technologies Inc. All rights reserved.
*
* Version: 2.1.4-104
*/
!function(h){"use strict";var p=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return p(t())}}},s=function(){},g=function(n){return function(){return n}},n=function(n){return n};var e,t,o,r,i,u,c,a=g(!1),f=g(!0),m=function(){return d},d=(e=function(n){return n.isNone()},r={fold:function(n,e){return n()},is:a,isSome:a,isNone:f,getOr:o=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:g(null),getOrUndefined:g(void 0),or:o,orThunk:t,map:m,each:s,bind:m,exists:a,forall:f,filter:m,equals:e,equals_:e,toArray:function(){return[]},toString:g("none()")},Object.freeze&&Object.freeze(r),r),l=function(t){var n=g(t),e=function(){return r},o=function(n){return n(t)},r={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:f,isNone:a,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return l(n(t))},each:function(n){n(t)},bind:o,exists:o,forall:o,filter:function(n){return n(t)?r:d},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(a,function(n){return e(t,n)})}};return r},_={some:l,none:m,from:function(n){return null==n?d:l(n)}},v=function(n){return parseInt(n,10)},y=function(n,e){var t=n-e;return 0===t?0:0<t?1:-1},w=function(n,e,t){return{major:n,minor:e,patch:t}},b=function(n){var e=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(n);return e?w(v(e[1]),v(e[2]),v(e[3])):w(0,0,0)},T=function(n,e){var t=y(n.major,e.major);if(0!==t)return t;var o=y(n.minor,e.minor);if(0!==o)return o;var r=y(n.patch,e.patch);return 0!==r?r:0},O=function(n){return b([(e=n).majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."));var e},S=function(n,e){return!!n&&-1===T(O(n),b(e))},C=0,E=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++C+String(e)},x=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(n)===e}},D=x("string"),A=x("object"),N=x("boolean"),k=x("function"),M=x("number"),R=Array.prototype.slice,j=Array.prototype.indexOf,I=function(n,e){return t=n,o=e,-1<j.call(t,o);var t,o},L=function(n,e){for(var t=n.length,o=new Array(t),r=0;r<t;r++){var i=n[r];o[r]=e(i,r)}return o},U=function(n,e){for(var t=0,o=n.length;t<o;t++){e(n[t],t)}},F=function(n,e){for(var t=[],o=0,r=n.length;o<r;o++){var i=n[o];e(i,o)&&t.push(i)}return t},P=function(n,e){for(var t=0,o=n.length;t<o;t++){var r=n[t];if(e(r,t))return _.some(r)}return _.none()},B=(k(Array.from)&&Array.from,Object.keys),H=Object.hasOwnProperty,V=function(n,e){for(var t=B(n),o=0,r=t.length;o<r;o++){var i=t[o];e(n[i],i)}},Y=function(n,t){return q(n,function(n,e){return{k:e,v:t(n,e)}})},q=function(n,o){var r={};return V(n,function(n,e){var t=o(n,e);r[t.k]=t.v}),r},W=(h.Node.ATTRIBUTE_NODE,h.Node.CDATA_SECTION_NODE,h.Node.COMMENT_NODE),X=h.Node.DOCUMENT_NODE,z=(h.Node.DOCUMENT_TYPE_NODE,h.Node.DOCUMENT_FRAGMENT_NODE,h.Node.ELEMENT_NODE),G=(h.Node.TEXT_NODE,h.Node.PROCESSING_INSTRUCTION_NODE,h.Node.ENTITY_REFERENCE_NODE,h.Node.ENTITY_NODE,h.Node.NOTATION_NODE,void 0!==h.window?h.window:Function("return this;")(),function(n,e,t){if(!(D(t)||N(t)||M(t)))throw h.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")}),J=function(n,e,t){G(n.dom(),e,t)},$=function(n,e){n.dom().removeAttribute(e)},K=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:g(n)}},Q={fromHtml:function(n,e){var t=(e||h.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw h.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return K(t.childNodes[0])},fromTag:function(n,e){var t=(e||h.document).createElement(n);return K(t)},fromText:function(n,e){var t=(e||h.document).createTextNode(n);return K(t)},fromDom:K,fromPoint:function(n,e,t){var o=n.dom();return _.from(o.elementFromPoint(e,t)).map(K)}},Z=(c=!(i=function(){return nn(Q.fromDom(h.document))}),function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return c||(c=!0,u=i.apply(null,n)),u}),nn=function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return Q.fromDom(e)},en=function(n,e){return-1!==n.indexOf(e)},tn=function(n,e,t){if(!D(t))throw h.console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);var o;void 0!==(o=n).style&&k(o.style.getPropertyValue)&&n.style.setProperty(e,t)},on=function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)},rn=function(n,e){return on(n,e,h.Node.DOCUMENT_POSITION_CONTAINED_BY)},un=function(){return(un=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)};var cn,an,sn,fn=function(){return mn(0,0)},mn=function(n,e){return{major:n,minor:e}},dn={nu:mn,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?fn():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var o=n[t];if(o.test(e))return o}}(n,e);if(!t)return{major:0,minor:0};var o=function(n){return Number(e.replace(t,"$"+n))};return mn(o(1),o(2))}(n,t)},unknown:fn},ln="Firefox",vn=function(n,e){return function(){return e===n}},hn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:vn("Edge",e),isChrome:vn("Chrome",e),isIE:vn("IE",e),isOpera:vn("Opera",e),isFirefox:vn(ln,e),isSafari:vn("Safari",e)}},pn={unknown:function(){return hn({current:void 0,version:dn.unknown()})},nu:hn,edge:g("Edge"),chrome:g("Chrome"),ie:g("IE"),opera:g("Opera"),firefox:g(ln),safari:g("Safari")},_n="Windows",gn="Android",yn="Solaris",wn="FreeBSD",bn="ChromeOS",Tn=function(n,e){return function(){return e===n}},On=function(n){var e=n.current;return{current:e,version:n.version,isWindows:Tn(_n,e),isiOS:Tn("iOS",e),isAndroid:Tn(gn,e),isOSX:Tn("OSX",e),isLinux:Tn("Linux",e),isSolaris:Tn(yn,e),isFreeBSD:Tn(wn,e),isChromeOS:Tn(bn,e)}},Sn={unknown:function(){return On({current:void 0,version:dn.unknown()})},nu:On,windows:g(_n),ios:g("iOS"),android:g(gn),linux:g("Linux"),osx:g("OSX"),solaris:g(yn),freebsd:g(wn),chromeos:g(bn)},Cn=function(n,e){var t=String(e).toLowerCase();return P(n,function(n){return n.search(t)})},En=function(n,t){return Cn(n,t).map(function(n){var e=dn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},xn=function(n,t){return Cn(n,t).map(function(n){var e=dn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Dn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,An=function(e){return function(n){return en(n,e)}},Nn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return en(n,"edge/")&&en(n,"chrome")&&en(n,"safari")&&en(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Dn],search:function(n){return en(n,"chrome")&&!en(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return en(n,"msie")||en(n,"trident")}},{name:"Opera",versionRegexes:[Dn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:An("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:An("firefox")},{name:"Safari",versionRegexes:[Dn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(en(n,"safari")||en(n,"mobile/"))&&en(n,"applewebkit")}}],kn=[{name:"Windows",search:An("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return en(n,"iphone")||en(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:An("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:An("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:An("linux"),versionRegexes:[]},{name:"Solaris",search:An("sunos"),versionRegexes:[]},{name:"FreeBSD",search:An("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:An("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Mn={browsers:g(Nn),oses:g(kn)},Rn=p(function(n,e){var t,o,r,i,u,c,a,s,f,m,d,l,v=Mn.browsers(),h=Mn.oses(),p=En(v,n).fold(pn.unknown,pn.nu),_=xn(h,n).fold(Sn.unknown,Sn.nu);return{browser:p,os:_,deviceType:(o=p,r=n,i=e,u=(t=_).isiOS()&&!0===/ipad/i.test(r),c=t.isiOS()&&!u,a=t.isiOS()||t.isAndroid(),s=a||i("(pointer:coarse)"),f=u||!c&&a&&i("(min-device-width:768px)"),m=c||a&&!f,d=o.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),l=!m&&!f&&!d,{isiPad:g(u),isiPhone:g(c),isTablet:g(f),isPhone:g(m),isTouch:g(s),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:g(d),isDesktop:g(l)})}}(h.navigator.userAgent,function(n){return h.window.matchMedia(n).matches})),jn=function(){return Rn.get()},In=z,Ln=X,Un=function(n){return n.nodeType!==In&&n.nodeType!==Ln||0===n.childElementCount},Fn=(jn().browser.isIE(),function(n){return Q.fromDom(n.dom().ownerDocument)}),Pn=function(n){return L(n.dom().childNodes,Q.fromDom)},Bn=(function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]}("element","offset"),function(e,t){var n;(n=e,_.from(n.dom().parentNode).map(Q.fromDom)).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})}),Hn=function(n,e){n.dom().appendChild(e.dom())},Vn=function(n){n.dom().textContent="",U(Pn(n),function(n){Yn(n)})},Yn=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},qn=function(n){var e,t=Pn(n);0<t.length&&(e=n,U(t,function(n){Bn(e,n)})),Yn(n)},Wn=function(n,e){var t,o,r,i=Fn(n).dom(),u=Q.fromDom(i.createDocumentFragment()),c=(t=e,(o=(i||h.document).createElement("div")).innerHTML=t,Pn(Q.fromDom(o)));r=u,U(c,function(n){Hn(r,n)}),Vn(n),Hn(n,u)},Xn=function(n,e){return t=e,r=void 0===(o=n)?h.document:o.dom(),Un(r)?_.none():_.from(r.querySelector(t)).map(Q.fromDom);var t,o,r},zn=jn().os.isOSX()?"⌘":"Ctrl",Gn=Y({tc_menu_name:"TinyComments",tc_announce_sidebar_available:"Comment. Sidebar available. Press "+zn+" + Alt + M to switch to sidebar",tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_save:"Save",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Say something ...",tc_kebab_deleteconversation:"Delete conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the Console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_create_problem:"An error occurred while creating a comment. See the Console for details",tc_reply_problem:"An error occurred while replying to a comment. See the Console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_delete_problem_all:"An error occurred deleting all the conversations. See the Console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the Console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the Console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_comment_buttons_showmore:"SHOW MORE",tc_comment_buttons_showless:"SHOW LESS"},n),Jn=E("aria-comment-description"),$n=function(n){var e,t,o=Xn(Z(),"#"+Jn).getOrThunk(function(){var n,t,e=Q.fromTag("span");return J(e,"id",Jn),J(e,"aria-live","polite"),J(e,"aria-atomic","true"),J(e,"role","alert"),n={position:"absolute",left:"-10000px",top:"-1000px"},t=e.dom(),V(n,function(n,e){tn(t,e,n)}),Hn(Z(),e),e});return e=n,t=o,{onComment:function(){Wn(t,e.translate(Gn.tc_announce_sidebar_available))},notOnComment:function(){Wn(t,"")},getMarker:function(){return t}}},Kn=function(o,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=o.console;t&&r in t&&t[r].apply(t,arguments)}},Qn={log:Kn(h.window,"log"),error:Kn(h.window,"error"),warn:Kn(h.window,"warm")},Zn={},ne={exports:Zn};an=Zn,sn=ne,cn=void 0,function(n){"object"==typeof an&&void 0!==sn?sn.exports=n():"function"==typeof cn&&cn.amd?cn([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}(function(){return function i(u,c,a){function s(e,n){if(!c[e]){if(!u[e]){var t=!1;if(!n&&t)return t(e,!0);if(f)return f(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var r=c[e]={exports:{}};u[e][0].call(r.exports,function(n){return s(u[e][1][n]||n)},r,r.exports,i,u,c,a)}return c[e].exports}for(var f=!1,n=0;n<a.length;n++)s(a[n]);return s}({1:[function(n,e,t){var o,r,i=e.exports={};function u(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(e){if(o===setTimeout)return setTimeout(e,0);if((o===u||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(n){try{return o.call(null,e,0)}catch(n){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:u}catch(n){o=u}try{r="function"==typeof clearTimeout?clearTimeout:c}catch(n){r=c}}();var s,f=[],m=!1,d=-1;function l(){m&&s&&(m=!1,s.length?f=s.concat(f):d=-1,f.length&&v())}function v(){if(!m){var n=a(l);m=!0;for(var e=f.length;e;){for(s=f,f=[];++d<e;)s&&s[d].run();d=-1,e=f.length}s=null,m=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===c||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(n){try{return r.call(null,e)}catch(n){return r.call(this,e)}}}(n)}}function h(n,e){this.fun=n,this.array=e}function p(){}i.nextTick=function(n){var e=new Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];f.push(new h(n,e)),1!==f.length||m||a(v)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(n){return[]},i.binding=function(n){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(n){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(n,m,e){(function(t){!function(n){var e=setTimeout;function o(){}function i(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(n,this)}function r(t,o){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,i._immediateFn(function(){var n=1===t._state?o.onFulfilled:o.onRejected;if(null!==n){var e;try{e=n(t._value)}catch(n){return void c(o.promise,n)}u(o.promise,e)}else(1===t._state?u:c)(o.promise,t._value)})):t._deferreds.push(o)}function u(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof i)return e._state=3,e._value=n,void a(e);if("function"==typeof t)return void f((o=t,r=n,function(){o.apply(r,arguments)}),e)}e._state=1,e._value=n,a(e)}catch(n){c(e,n)}var o,r}function c(n,e){n._state=2,n._value=e,a(n)}function a(n){2===n._state&&0===n._deferreds.length&&i._immediateFn(function(){n._handled||i._unhandledRejectionFn(n._value)});for(var e=0,t=n._deferreds.length;e<t;e++)r(n,n._deferreds[e]);n._deferreds=null}function s(n,e,t){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.promise=t}function f(n,e){var t=!1;try{n(function(n){t||(t=!0,u(e,n))},function(n){t||(t=!0,c(e,n))})}catch(n){if(t)return;t=!0,c(e,n)}}i.prototype.catch=function(n){return this.then(null,n)},i.prototype.then=function(n,e){var t=new this.constructor(o);return r(this,new s(n,e,t)),t},i.all=function(n){var c=Array.prototype.slice.call(n);return new i(function(o,r){if(0===c.length)return o([]);var i=c.length;function u(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){u(e,n)},r)}c[e]=n,0==--i&&o(c)}catch(n){r(n)}}for(var n=0;n<c.length;n++)u(n,c[n])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(n){n(e)})},i.reject=function(t){return new i(function(n,e){e(t)})},i.race=function(r){return new i(function(n,e){for(var t=0,o=r.length;t<o;t++)r[t].then(n,e)})},i._immediateFn="function"==typeof t?function(n){t(n)}:function(n){e(n,0)},i._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},i._setImmediateFn=function(n){i._immediateFn=n},i._setUnhandledRejectionFn=function(n){i._unhandledRejectionFn=n},void 0!==m&&m.exports?m.exports=i:n.Promise||(n.Promise=i)}(this)}).call(this,n("timers").setImmediate)},{timers:3}],3:[function(a,n,s){(function(n,e){var o=a("process/browser.js").nextTick,t=Function.prototype.apply,r=Array.prototype.slice,i={},u=0;function c(n,e){this._id=n,this._clearFn=e}s.setTimeout=function(){return new c(t.call(setTimeout,window,arguments),clearTimeout)},s.setInterval=function(){return new c(t.call(setInterval,window,arguments),clearInterval)},s.clearTimeout=s.clearInterval=function(n){n.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},s.enroll=function(n,e){clearTimeout(n._idleTimeoutId),n._idleTimeout=e},s.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},s._unrefActive=s.active=function(n){clearTimeout(n._idleTimeoutId);var e=n._idleTimeout;0<=e&&(n._idleTimeoutId=setTimeout(function(){n._onTimeout&&n._onTimeout()},e))},s.setImmediate="function"==typeof n?n:function(n){var e=u++,t=!(arguments.length<2)&&r.call(arguments,1);return i[e]=!0,o(function(){i[e]&&(t?n.apply(null,t):n.call(null),s.clearImmediate(e))}),e},s.clearImmediate="function"==typeof e?e:function(n){delete i[n]}}).call(this,a("timers").setImmediate,a("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,e,t){var o=n("promise-polyfill"),r="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:r.Promise||o}},{"promise-polyfill":2}]},{},[4])(4)});var ee,te,oe=ne.exports.boltExport,re=function(n){var t=_.none(),e=[],o=function(n){r()?u(n):e.push(n)},r=function(){return t.isSome()},i=function(n){U(n,u)},u=function(e){t.each(function(n){h.setTimeout(function(){e(n)},0)})};return n(function(n){t=_.some(n),i(e),e=[]}),{get:o,map:function(t){return re(function(e){o(function(n){e(t(n))})})},isReady:r}},ie={nu:re,pure:function(e){return re(function(n){n(e)})}},ue=function(n){h.setTimeout(function(){throw n},0)},ce=function(t){var n=function(n){t().then(n,ue)};return{map:function(n){return ce(function(){return t().then(n)})},bind:function(e){return ce(function(){return t().then(function(n){return e(n).toPromise()})})},anonBind:function(n){return ce(function(){return t().then(function(){return n.toPromise()})})},toLazy:function(){return ie.nu(n)},toCached:function(){var n=null;return ce(function(){return null===n&&(n=t()),n})},toPromise:t,get:n}},ae=function(n){return ce(function(){return new oe(n)})},se=function(n){return ce(function(){return oe.resolve(n)})},fe=function(u,n){return n(function(o){var r=[],i=0;0===u.length?o([]):U(u,function(n,e){var t;n.get((t=e,function(n){r[t]=n,++i>=u.length&&o(r)}))})})},me=function(n){return fe(n,ae)},de=function(n){var t,o,e,r,i,u,c,a,s,f=Q.fromDom(n.target),m=function(){n.stopPropagation()},d=function(){n.preventDefault()},l=(t=d,o=m,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(o.apply(null,n))});return e=f,r=n.clientX,i=n.clientY,u=m,c=d,a=l,s=n,{target:g(e),x:g(r),y:g(i),stop:u,prevent:c,kill:a,raw:g(s)}},le=function(n,e,t,o,r){var i,u,c=(i=t,u=o,function(n){i(n)&&u(de(n))});return n.dom().addEventListener(e,c,r),{unbind:function(o){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=r.concat(n);return o.apply(null,t)}}(ve,n,e,c,r)}},ve=function(n,e,t,o){n.dom().removeEventListener(e,t,o)},he=g(!0),pe=function(n,e,t){return le(n,e,he,t,!1)},_e=p(_.none()),ge="_tinycomments_sidebar",ye=function(r){return ae(function(n){var e,t,o=Q.fromTag("link");e={rel:"stylesheet",href:r},t=o.dom(),V(e,function(n,e){G(t,e,n)}),pe(o,"load",function(){n()}),Hn(Q.fromDom(h.document.head),o)})},we=function(e){return _e.get().getOrThunk(function(){var n=ae(function(n){tinymce[ge]=n,me(L(e,function(n){return("js"===n.type?function(t){return ae(function(n){var e=Q.fromTag("script");J(e,"src",t),pe(e,"load",function(){n()}),Hn(Z(),e)})}:ye)(n.filename)})).get(s)}).toLazy();return _e.set(_.some(n)),n})};(te=ee||(ee={}))[te.Modern=0]="Modern",te[te.Silver=1]="Silver";var be,Te=function(n,e){return t=e,r=void 0===(o=n)?h.document:o.dom(),Un(r)?[]:L(r.querySelectorAll(t),Q.fromDom);var t,o,r},Oe=g("tox-comment"),Se=g("data-mce-annotation-uid"),Ce=g("data-mce-annotation"),Ee=g("tinycomments"),xe=g("tox-comments-visible"),De=function(n,e,t,o){return Wn(n,e),U(Te(n,t),o),n.dom().innerHTML},Ae=function(o,r,i){for(var u=Q.fromTag("div"),n=function(t){o[t].content=De(u,o[t].content,r,i),U(o[t].fragments||[],function(n,e){o[t].fragments[e]=De(u,o[t].fragments[e],r,i)})},e=0;e<o.length;e++)n(e)},Ne=function(n,e){var t;Ae(n,(t=e,"["+Se()+'="'+t+'"]'),qn)},ke=function(n){Ae(n,"["+Ce()+'="'+Ee()+'"]',qn)},Me="tc-open-comment",Re="tc-try-delete-all-conversations",je="tc-delete-conversation-at-cursor",Ie=function(o,r,t){var i=Ee();o.addCommand(Re,function(n,e){o.windowManager.confirm(Gn.tc_delete_prompts_all,function(n){if(n)return t.deleteAllConversations({}).get(function(n){n.fold(function(n){return r.showError(Gn.tc_delete_problem_all,n)},function(n){if(n.canDelete){var e=o.selection.getBookmark();o.focus();var t=o.annotator.getAll(i);V(t,function(n,e){var t;(t=n,0===t.length?_.none():_.some(t[0])).each(function(n){o.selection.select(n),o.annotator.remove(i)})}),o.selection.moveToBookmark(e),ke(o.undoManager.data),r.refreshSidebar(_.none(),2),o.focus()}else r.showError(Gn.tc_delete_unauthorised_all)})})})})},Le=function(n,e,u,c){n.on("init",function(){var o,r,t,i;o=e,r=c,n.addCommand(Me,function(n,e){var t=r.get();o.refreshSidebar(t,e.grabFocus?1:0)}),i=e,(t=n).addCommand(je,function(n,e){t.undoManager.transact(function(){return t.annotator.remove(Ee())}),Ne(t.undoManager.data,e.conversationUid),i.refreshSidebar(_.none(),2),t.focus()}),Ie(n,e,u)})},Ue=function(n,e){return n.execCommand(Me,null,{grabFocus:e})},Fe=function(n){n.execCommand(Re,null,{})},Pe=function(n,e){n.execCommand("ToggleSidebar",null,e)},Be=function(t){return{is:function(n){return t===n},isValue:f,isError:a,getOr:g(t),getOrThunk:g(t),getOrDie:g(t),or:function(n){return Be(t)},orThunk:function(n){return Be(t)},fold:function(n,e){return e(t)},map:function(n){return Be(n(t))},mapError:function(n){return Be(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return _.some(t)}}},He=function(t){return{is:a,isValue:a,isError:f,getOr:n,getOrThunk:function(n){return n()},getOrDie:function(){return n=String(t),function(){throw new Error(n)}();var n},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return He(t)},mapError:function(n){return He(n(t))},each:s,bind:function(n){return He(t)},exists:a,forall:f,toOption:_.none}},Ve={value:Be,error:He,fromOption:function(n,e){return n.fold(function(){return He(e)},Be)}},Ye=function(i){return un(un({},i),{toCached:function(){return Ye(i.toCached())},bindFuture:function(e){return Ye(i.bind(function(n){return n.fold(function(n){return se(Ve.error(n))},function(n){return e(n)})}))},bindResult:function(e){return Ye(i.map(function(n){return n.bind(e)}))},mapResult:function(e){return Ye(i.map(function(n){return n.map(e)}))},mapError:function(e){return Ye(i.map(function(n){return n.mapError(e)}))},foldResult:function(e,t){return i.map(function(n){return n.fold(e,t)})},withTimeout:function(n,r){return Ye(ae(function(e){var t=!1,o=h.setTimeout(function(){t=!0,e(Ve.error(r()))},n);i.get(function(n){t||(h.clearTimeout(o),e(n))})}))}})},qe=function(n){return Ye(ae(n))},We=function(n){return Ye(se(Ve.value(n)))},Xe=qe,ze=We,Ge=function(n){return Ye(se(Ve.error(n)))},Je=function(t){return function(n){return Xe(function(e){return t(n,function(n){e(Ve.value(n))},function(n){e(Ve.error(n))})})}},$e=function(t){return function(n){var e=n.settings[t];if(k(e))return e;throw new Error(t+" has not been implemented.")}},Ke=function(o,r){return function(n){return e=n.settings,t=o,H.call(e,t)?n.settings[o]:r(n);var e,t}},Qe=function(t,o){return function(n){var e=Ke(t,function(){return o(ut(n))})(n);return Je(e)}},Ze=$e("tinycomments_create"),nt=$e("tinycomments_reply"),et=$e("tinycomments_delete"),tt=$e("tinycomments_delete_all"),ot=$e("tinycomments_delete_comment"),rt=$e("tinycomments_edit_comment"),it=$e("tinycomments_lookup"),ut=Ke("tinycomments_author",function(){return"Anon"}),ct=Ke("tinycomments_author_name",ut),at=Qe("tinycomments_can_delete",function(o){return function(n,e,t){e({canDelete:0<n.comments.length&&n.comments[0].author===o&&!0})}}),st=Qe("tinycomments_can_delete_comment",function(o){return function(n,e,t){e({canDelete:n.comment.author===o&&!0})}}),ft=Qe("tinycomments_can_edit_comment",function(o){return function(n,e,t){e({canEdit:n.comment.author===o&&!0})}}),mt=Ke("tinycomments_mode",function(){return"callback"}),dt=Object.prototype.hasOwnProperty,lt=(be=function(n,e){return A(n)&&A(e)?lt(n,e):e},function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},o=0;o<n.length;o++){var r=n[o];for(var i in r)dt.call(r,i)&&(t[i]=be(t[i],r[i]))}return t}),vt=function(n){var o,e=Ze(n),t=nt(n),r=it(n),i=et(n),u=tt(n),c=ot(n),a=rt(n);return{create:Je(e),reply:Je(t),lookup:Je((o=r,function(n,t,e){o(n,function(n){var e=L(n.conversation.comments,function(n){return un({authorName:n.author},n)});t(lt(n,{conversation:{comments:e}}))},e)})),deleteConversation:Je(i),deleteAllConversations:Je(u),editComment:Je(a),deleteComment:Je(c),lifecycleHooks:{onSetContent:s,onGetContent:_.none}}},ht=function(e){return function(n){return{uid:n.uid,comments:F(n.comments,function(n){return n.uid!==e})}}},pt=function(e,t,o){return function(n){return{uid:n.uid,comments:L(n.comments,function(n){return n.uid===e?un(un({},n),{content:t,modifiedAt:o}):n})}}};var _t,gt,yt,wt=(_t=function(n){return n.dom().nodeType===W||"#comment"===n.dom().nodeName.toLowerCase()},gt="comment",{get:function(n){if(!_t(n))throw new Error("Can only get "+gt+" value of a "+gt+" node");return yt(n).getOr("")},getOption:yt=function(n){return _t(n)?_.from(n.dom().nodeValue):_.none()},set:function(n,e){if(!_t(n))throw new Error("Can only set raw "+gt+" value of a "+gt+" node");n.dom().nodeValue=e}});var bt=function(n){return function(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return _.none();for(var o=t[1],r=e[1],i=h.atob(r),u=i.length,c=Math.ceil(u/1024),a=new Array(c),s=0;s<c;++s){for(var f=1024*s,m=Math.min(f+1024,u),d=new Array(m-f),l=f,v=0;l<m;++v,++l)d[v]=i[l].charCodeAt(0);a[s]=new Uint8Array(d)}return _.some(new h.Blob(a,{type:o}))}(n)};var Tt={base64:{versions:["2.0","2.1"],encryptor:{encryptText:function(n){var e=new h.Blob([n],{type:"application/json"}),t=new h.FileReader;return Xe(function(n){t.addEventListener("loadend",function(){return n(Ve.value({encrypted:[t.result]}))}),t.addEventListener("error",function(){return n(Ve.error(t.error))}),t.readAsDataURL(e)})},decryptText:function(n){return bt(n[0]).fold(function(){return Ge("Could not decode URI")},function(e){var t=new h.FileReader;return Xe(function(n){t.addEventListener("loadend",function(){return n(Ve.value({decrypted:t.result}))}),t.addEventListener("error",function(){return n(Ve.error(t.error.message))}),t.readAsText(e)})})}}}};Tt.current=Tt.base64;var Ot=function(e){return function(n,e){for(var t=B(n),o=0,r=t.length;o<r;o++){var i=t[o],u=n[i];if(e(u,i,n))return _.some(u)}return _.none()}(Tt,function(n){return I(n.versions,e)}).map(function(n){return n.encryptor})},St=function(){return Tt.current.encryptor},Ct=function(n,e,t){if(e===n)return t;switch(n){case"2.0":return Ct("2.1",e,un(un({},o=t),{authorName:o.author}));default:return t}var o},Et="tinycomments",xt=function(n){return(e=n,wt.getOption(e)).map(function(n){return e=n.replace(/^\s+/g,""),t=e,r=0,""===(o=Et)||!(t.length<o.length)&&t.substr(r,r+o.length)===o;var e,t,o,r}).isSome();var e},Dt=function(n){var e,t,o=(t=n,e=wt.get(t),e.replace(/^\s+|\s+$/g,"")).split("|");return 2<o.length?Ve.value({version:o[1],rest:o.slice(2)}):Ve.error("Embedded comments not in expected format.")},At=function(n){return function(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var o=Array(n),r=0;for(e=0;e<t;e++)for(var i=arguments[e],u=0,c=i.length;u<c;u++,r++)o[r]=i[u];return o}([Et,"2.1"],n.encrypted).join("|")},Nt=function(n){try{var e=JSON.parse(n);return Ve.value(e)}catch(n){return Ve.error("Could not JSON parse conversations.")}},kt=function(n){return(e=n,t=xt,P(e.dom().childNodes,function(n){return t(Q.fromDom(n))}).map(Q.fromDom)).fold(function(){return ze({conversations:{},commentTag:_.none(),encrypted:{encrypted:[]}})},function(c){return Dt(c).fold(Ge,function(n){var e,t,i=n.version,u=n.rest;return(e=i,t=u,Ot(e).fold(function(){return Ge("No Encryptor for version: "+e)},function(n){return n.decryptText(t)})).bindResult(function(n){var e,t,o,r=n.decrypted;return(e=i,t=r,o=Nt(t),"2.1"!==e?o.map(function(n){return Y(n,function(n){return un(un({},n),{comments:L(n.comments,function(n){return Ct(e,"2.1",n)})})})}):o).map(function(n){return{commentTag:_.some(c),conversations:n,encrypted:{encrypted:u}}})})})});var e,t},Mt=function(n){var e,t,o,r=Q.fromDom(h.document.createComment(At(n)));return e=r,t=Q.fromTag("div"),o=Q.fromDom(e.dom().cloneNode(!0)),Hn(t,o),t.dom().innerHTML},Rt=function(n){var r,t,e,o=ut(n),i=ct(n),u=(r={},t=_.none(),{get:function(){return lt(r,{})},clear:function(){r={},t=_.none()},addData:function(n,e){r[n]=e},setData:function(n,e){r=n,t=_.some(e)},setEncryptedData:function(n){t=_.some(n)},getEncrypedData:function(){return t},lookupData:e=function(n){return Object.prototype.hasOwnProperty.call(r,n)?_.some(r[n]):_.none()},removeData:function(n){delete r[n]},updateData:function(t,o){return e(t).map(function(n){var e=o(n);return r[t]=e})}}),c=at(n),a=st(n),s=ft(n),f=St(),m=function(){return f.encryptText(JSON.stringify(u.get())).mapResult(function(n){return u.setEncryptedData(n)})},d=function(o,r,n,i){return(t=o,u.lookupData(t.conversationUid).fold(function(){return Ve.error("Could not find conversation with uid "+t.conversationUid)},function(e){return P(e.comments,function(n){return n.uid===t.commentUid}).fold(function(){return Ve.error("Could not find comment with uid "+t.commentUid+" in conversation "+t.conversationUid)},function(n){return Ve.value({conversationUid:e.uid,comment:n})})})).fold(function(n){return Ge(n)},function(t){return n(t).bindFuture(function(n){var e;return!0!==n[r]?ze(((e={})[r]=!1,e)):u.updateData(o.conversationUid,i(t)).fold(function(){return Ge("Could not operate on comment ("+r+")")},function(n){return m().mapResult(function(){var n;return(n={})[r]=!0,n})})})});var t};return{create:function(n){var e=E("mce-conversation");return u.addData(e,{uid:e,comments:[{uid:e,author:o,authorName:i,content:n.content,createdAt:n.createdAt,modifiedAt:n.createdAt}]}),m().mapResult(function(){return{conversationUid:e}})},reply:function(n){var e=E("mce-reply"),t={uid:e,author:o,authorName:i,content:n.content,createdAt:n.createdAt,modifiedAt:n.createdAt};return u.updateData(n.conversationUid,function(n){return un(un({},n),{comments:n.comments.concat([t])})}).fold(function(){return Ge("Could not reply to uid: "+n.conversationUid)},function(){return m().mapResult(function(){return{commentUid:e}})})},lookup:function(n){return u.lookupData(n.conversationUid).fold(function(){return Ge("Could not find uid: "+n.conversationUid)},function(n){return ze({conversation:n})})},deleteConversation:function(e){return u.lookupData(e.conversationUid).fold(function(){return Ge("Could not find conversation to delete")},function(n){return c({conversationUid:n.uid,comments:n.comments}).bindFuture(function(n){return n.canDelete?(u.removeData(e.conversationUid),m().mapResult(function(){return{canDelete:!0}})):ze({canDelete:!1})})})},deleteAllConversations:function(n){var e=B(u.get()),o=L(e,function(n){return u.lookupData(n).fold(function(){return Ge("Could not find conversation")},function(n){return c({conversationUid:n.uid,comments:n.comments})})});return Xe(function(t){me(o).get(function(n){var e=function(n,e){for(var t=0,o=n.length;t<o;++t)if(!0!==e(n[t],t))return!1;return!0}(n,function(n){return n.exists(function(n){return n.canDelete})});e&&u.clear(),t(Ve.value({canDelete:e}))})})},deleteComment:function(n){return d(n,"canDelete",a,function(n){return ht(n.comment.uid)})},editComment:function(e){return d(e,"canEdit",function(n){return s(un(un({},n),{edit:{modifiedAt:e.modifiedAt,content:e.content}}))},function(n){return pt(e.commentUid,e.content,e.modifiedAt)})},lifecycleHooks:{onSetContent:function(n){kt(Q.fromDom(n.getBody())).get(function(n){return n.fold(function(n){return console.error("Error extracting embedded conversations: "+n)},function(e){e.commentTag.each(function(n){u.setData(e.conversations,e.encrypted),Yn(n)})})})},onGetContent:function(n,e){return u.getEncrypedData().map(function(n){return e+Mt(n)})}}}},jt=function(n,i,u){n.on("init",function(){n.annotator.register(Ee(),{decorate:function(){return{classes:[Oe()],attributes:{}}}}),n.annotator.annotationChanged(Ee(),function(n,e,t){if(n){u.onComment();var o=t.uid,r=t.nodes;i.refreshView(_.some({uid:o,nodes:L(r,Q.fromDom)}))}else u.notOnComment(),i.refreshView(_.none())})})};var It,Lt,Ut=function(n,e){var t,o,r=(t=e,null===(o=n.dom().getAttribute(t))?void 0:o);return void 0===r||""===r?[]:r.split(" ")},Ft=function(n){return void 0!==n.dom().classList},Pt=function(n,e){return r=e,i=Ut(t=n,o="class").concat([r]),J(t,o,i.join(" ")),!0;var t,o,r,i},Bt=function(n,e){return r=e,0<(i=F(Ut(t=n,o="class"),function(n){return n!==r})).length?J(t,o,i.join(" ")):$(t,o),!1;var t,o,r,i},Ht=function(n){0===(Ft(n)?n.dom().classList:Ut(n,"class")).length&&$(n,"class")},Vt=function(e){return(n=Fn(e),t=void 0!==n?n.dom():h.document,_.from(t.activeElement).map(Q.fromDom)).filter(function(n){return e.dom().contains(n.dom())});var n,t},Yt=function(o,r){return function(n){var e,t;r.set(It.Open),e=Q.fromDom(o.getBody()),t=xe(),Ft(e)?e.dom().classList.add(t):Pt(e,t),o.fire("mce-tinycomments-update",{}),Ue(o,!1)}},qt=function(e,t){return function(n){Vt(Q.fromDom(n.element())).each(function(n){e.focus()}),t.set(It.Closed),function(n,e){Ft(n)?n.dom().classList.remove(e):Bt(n,e);Ht(n)}(Q.fromDom(e.getBody()),xe()),e.fire("mce-tinycomments-update",{})}},Wt=function(n,e){n===ee.Modern?e.getContainer().querySelector(".mce-sidebar-toolbar .mce-i-conversation").click():Pe(e,"showcomments")},Xt=function(n,e,t){t.get()!==It.Closed&&t.get()!==It.Closing||Wt(n,e),Ue(e,!0)},zt=function(t,e,o){var n,r,i=(n=tinymce,r="5.0.4",n&&1===T(O(n),b(r))?"comment-add":"comment");t.ui.registry.addButton("addcomment",{tooltip:Gn.tc_items_addcomment,shortcut:"meta+Alt+M",icon:i,onAction:function(){Xt(ee.Silver,t,o)}}),t.ui.registry.addMenuItem("addcomment",{text:Gn.tc_items_addcomment,shortcut:"meta+Alt+M",icon:i,onAction:function(){Xt(ee.Silver,t,o)}}),t.ui.registry.addMenuItem("deleteallconversations",{text:Gn.tc_items_deleteall,onAction:function(){Fe(t)}}),t.ui.registry.addToggleMenuItem("showcomments",{text:Gn.tc_items_showcomments,icon:"comment",onAction:function(){Wt(ee.Silver,t)},onSetup:function(n){var e=function(){n.setActive(o.get()===It.Open)};return t.on("mce-tinycomments-update",e),e(),function(){t.off("mce-tinycomments-update",e)}}}),t.ui.registry.addSidebar("showcomments",{tooltip:Gn.tc_items_showcomments,icon:"comment",onSetup:function(n){return e.rememberSidebar(Q.fromDom(n.element())),function(){}},onShow:Yt(t,o),onHide:qt(t,o)})},Gt=function(t,e,o){t.addButton("showcomments",{icon:"bubble",tooltip:Gn.tc_items_showcomments,onclick:function(){Wt(ee.Modern,t)},onPostRender:function(e){t.on("mce-tinycomments-update",function(n){e.control.active(o.get()===It.Open)})}}),t.addButton("addcomment",{tooltip:Gn.tc_items_addcomment,icon:"bubble",onclick:function(n){Xt(ee.Modern,t,o)}}),t.addMenuItem("showcomments",{text:Gn.tc_items_showcomments,context:"view",selectable:!0,onclick:function(n){Wt(ee.Modern,t)},onPostRender:function(e){t.on("mce-tinycomments-update",function(n){e.control.active(o.get()===It.Open)})}}),t.addMenuItem("addcomment",{text:Gn.tc_items_addcomment,context:"insert",onclick:function(n){Xt(ee.Modern,t,o)}}),t.addMenuItem("deleteallconversations",{text:Gn.tc_items_deleteall,context:"file",onclick:function(n){Fe(t)}}),t.addSidebar("showcomments",{tooltip:Gn.tc_items_showcomments,icon:"conversation",onrender:function(n){e.rememberSidebar(Q.fromDom(n.element()))},onshow:Yt(t,o),onhide:qt(t,o)})};(Lt=It||(It={}))[Lt.Open=0]="Open",Lt[Lt.Closed=1]="Closed",Lt[Lt.Closing=2]="Closing";var Jt=function(n,e,t){var o=p(It.Closed);e.shortcuts.add("meta+alt+m","TinyComments addComment",function(){Xt(n,e,o)}),(n===ee.Modern?Gt:zt)(e,t,o)},$t=function(i,u){var n,o,t,e,r,c,a=p(!1),s=p(_.none()),f=S(tinymce,"5.0.0")?ee.Modern:ee.Silver,m=("embedded"===mt(n=i)?Rt:vt)(n),d=(o=p(_.none()),t=p(_.none()),{rememberSidebar:function(e){t.set(_.some(e)),o.get().fold(function(){var n=Q.fromHtml('<div aria-busy="true" class="tox-conversations" style="position: relative;">\n  <div class="tox-dialog__busy-spinner">\n  <div class="tox-loading-text">\n      <div>\n      <p>Comments are loading</p>\n      </div>\n  <div class="tox-spinner">\n      <div></div>\n      <div></div>\n      <div></div>\n  </div>\n</div></div>');Hn(e,n)},function(n){n.attachTo(e)})},setUi:function(e){o.set(_.some(e)),t.get().each(function(n){Vn(n),e.attachTo(n)})},refreshView:function(e){o.get().fold(function(){},function(n){n.controller.refreshView(e)})},refreshSidebar:function(e,t){o.get().fold(function(){},function(n){n.controller.refreshSidebar(e,t)})},setReadonly:function(e){o.get().each(function(n){return n.controller.setReadonly(e)})},showError:function(e,t){o.get().each(function(n){return n.controller.showError(e,t)})}}),l={translate:tinymce.translate};we([{type:"js",filename:(e=i,r=u,c=e.settings.tinycomments_js_url,(c?c+"/":r+"/js/")+"tinycomments-sidebar.min.js")}]).get(function(n){return n(f,i,m,s,function(n){d.setUi(n),d.refreshSidebar(s.get(),5),a.set(!0)},l)});var v=$n(l);return Le(i,d,m,s),jt(i,d,v),Jt(f,i,d),i.on("init",function(){var n,e,t,o,r;n=f,t=u,o=(e=i).settings.tinycomments_css_url,r=o?o+"/":t+"/css/",tinymce.DOM.styleSheetLoader.load(r+"tinycomments.css",function(){}),n===ee.Modern&&(tinymce.DOM.styleSheetLoader.load(r+"tinycomments-tinymce4.css",function(){}),tinymce.DOM.styleSheetLoader.load(r+"tinymce4-icons.css",function(){}),e.dom.loadCSS(r+"tinymce4-content.css")),d.refreshSidebar(_.none(),5)}),i.on("setContent",function(n){n.selection||(m.lifecycleHooks.onSetContent(i),d.refreshView(_.none()))}),i.on("SwitchMode",function(){d.setReadonly(i.readonly)}),i.on("getContent",function(n){var e=!0===n.source_view,t=!0===n.contextual,o=e||t?_.none():m.lifecycleHooks.onGetContent(i,n.content);n.content=o.getOr(n.content)}),{hasLoadedUi:function(){return a.get()}}},Kt=function(n,e){return S(tinymce,"4.8.0")?(Qn.error("The tinycomments plugin requires at least 4.8.0 version of TinyMCE."),{}):$t(n,e)};tinymce.PluginManager.add("tinycomments",Kt)}(window);