{"version":3,"sources":["./src/app/_3D/engines/client-editor.engine.ts","./src/app/_3D/libs/project-editor.ts"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuD;AACgD;AAGnE;AACE;AACI;AACA;AACK;AACT;AACe;AACI;AAE+B;AAEpD;AAGE;AACI;AACa;AAEf;AAaxC,MAAM,kBAAkB,GAAG,2EAAW,CAAC,oBAAoB,CAAC,CAAC,IAAI,CAC7D,qDAAK,EACL,sDAAM,EACN,wDAAQ,EACR,wDAAQ,EACR,qDAAM,EACN,sDAAM,EACN,8DAAa,EACb,oDAAK,EACL,sEAAe,EACf,2DAAU,CACb,CAAC;IACE,IAAI,EAAE,EAAE;IACR,OAAO,EAAE,EAAE;IAEX,IAAI,EAAE,EAAE;IACR,QAAQ,EAAE,EAAE;IACZ,QAAQ,EAAE,EAAE;IACZ,KAAK,EAAE,EAAE;IACT,QAAQ,EAAE,EAAE;IACZ,OAAO,EAAE,EAAE;IACX,MAAM,EAAE,KAAK;IACb,cAAc,EAAE,IAAI;IAEpB,OAAO,EAAE,UAAS,IAAS;QACvB,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,uEAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC1C,IAAI,CAAC,QAAQ,GAAG,IAAI,0DAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;SACrD;QACD,IAAI,IAAI,CAAC,MAAM,IAAI,uEAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YACrC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC/B;QACD,IAAI,IAAI,CAAC,MAAM,IAAI,uEAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YACrC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC/B;QACD,IAAI,IAAI,CAAC,MAAM,IAAI,uEAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YACrC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC/B;QACD,IAAI,IAAI,CAAC,OAAO,IAAI,CAAC,uEAAO,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,wEAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE;YACnE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACjC;aAAI;YACD,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;SACtC;QACD,IAAI,IAAI,CAAC,KAAK,IAAI,uEAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YACnC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAC7B;QACD,IAAI,IAAI,CAAC,OAAO,IAAI,uEAAO,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;YACvC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACjC;QACD,IAAI,IAAI,CAAC,KAAK,IAAI,uEAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YACnC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAC7B;QACD,IAAI,IAAI,CAAC,QAAQ,IAAI,uEAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YACzC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SACnC;QACD,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAG/B,CAAC;IAED;;;;OAIG;IACH,WAAW,EAAE,UAAU,IAAS;QAC5B,IAAI,IAAI,IAAI,wEAAQ,CAAC,IAAI,CAAC,EAAE;YACxB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;SACpB;QACD,IAAI,CAAC,QAAQ,GAAG,4DAAU,CAAC;QAC3B,IAAI,CAAC,QAAQ,GAAG,2DAAS,CAAC;QAC1B,IAAI,CAAC,IAAI,GAAG,wDAAM,CAAC;QACnB,IAAI,CAAC,KAAK,GAAG,0DAAQ,CAAC;QACtB,IAAI,CAAC,MAAM,GAAG,IAAI,wDAAM,CAAC,IAAI,CAAC,CAAC;QAG/B,IAAI,IAAI,GAAG,IAAI,CAAC;QAEhB,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,UAAS,CAAC;YAC7B,IAAI,CAAC,eAAe,GAAG,KAAK;YAC5B,OAAO,GAAG,IAAI,CAAC;QACnB,CAAC,EAAE,KAAK,CAAC;QACT,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,UAAS,CAAC;YAC7C,IAAG,OAAO,EAAC;gBACP,IAAI,CAAC,eAAe,GAAG,IAAI;gBAC3B,OAAO,GAAG,KAAK,CAAC;aACnB;QAEL,CAAC,EAAE,KAAK,CAAC,CAAC;QAEV,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,UAAS,CAAC;YAC9B,IAAG,wEAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,EAAC;gBAC1D,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC;aAChC;QACL,CAAC,CAAC;IACN,CAAC;IAED,KAAK,EAAE,UAAS,IAAI;QAChB,IAAI,CAAC,IAAI,GAAG,2EAAW,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;QAClC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,IAAI,CAAC;YACN,IAAI,EAAE,OAAO;SAChB,CAAC;IACN,CAAC;IAED,cAAc,EAAE;QACZ,IAAI,IAAI,CAAC,IAAI,EAAE;YACX,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YACrB,IAAI,wEAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;gBACtB,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;gBACvB,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;gBAChC,IAAI,wEAAQ,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,uEAAO,CAAC,KAAK,CAAC,UAAU,CAAC;oBACxD,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;gBACzC,IAAI,wEAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,uEAAO,CAAC,KAAK,CAAC,KAAK,CAAC;oBAC9C,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAC9C,IAAI,wEAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,uEAAO,CAAC,KAAK,CAAC,IAAI,CAAC;oBAC5C,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;aAC5C;YACD,IAAG,wEAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;gBACpB,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC3C,IAAG,wEAAQ,CAAC,IAAI,CAAC,OAAO,CAAC;gBACrB,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC7C,IAAG,wEAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;gBACpB,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;SACxD;IAEL,CAAC;IAED,KAAK,EAAE,UAAU,KAAK;QAClB,IAAI,wEAAQ,CAAC,KAAK,CAAC;YAAE,IAAI,CAAC,IAAI,GAAG,2EAAW,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;QACxD,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAExB,IAAI,CAAC,IAAI,CAAC;YACN,IAAI,EAAE,OAAO;SAChB,CAAC;IACN,CAAC;IAGD,OAAO,EAAE,SAAS,OAAO,CAAE,IAAS;QAChC,IAAI,IAAI,CAAC,MAAM;YAAE,OAAO,IAAI,CAAC;QAG7B,IAAI,IAAI,IAAI,wEAAQ,CAAC,IAAI,CAAC,EAAE;YACxB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;SACpB;QACD,IAAI,CAAC,OAAO,GAAG,IAAI,iEAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC,CAAC;QACrF,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAEhC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;QACtC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC;QAC3C,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAC,KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAC,KAAI,CAAC,CAAC;QAE9F,IAAI,CAAC,MAAM,CAAC,sBAAsB,EAAE,CAAC;QACrC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC,CAAC;QAE7C,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACnB,uBAAuB;QACvB,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;YACxB,UAAU,CAAC;gBACP,IAAI,CAAC,MAAM,EAAE,CAAC;YAClB,CAAC,EAAE,GAAG,CAAC,CAAC;SACX;QAGD,OAAO,IAAI,CAAC;IAEhB,CAAC;IAED,eAAe,EAAE,IAAI;IAErB,gBAAgB,EAAE,UAAS,aAAa;QACpC,IAAG,CAAC,wEAAQ,CAAC,aAAa,CAAC,IAAE,IAAI,CAAC,aAAa,IAAI,aAAa;YAAE,OAAO,KAAK,CAAC;QAC/E,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACnC,aAAa,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,aAAa,CAAC,EAAE,CAAC,wBAAwB,EAAE,UAAS,CAAC;YACjD,IAAI,CAAC,2BAA2B,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;QAC/C,CAAC,CAAC,CAAC;QACH,aAAa,CAAC,OAAO,EAAE,CAAC;QACxB,UAAU,CAAC,GAAG,EAAE;YACZ,aAAa,CAAC,OAAO,EAAE,CAAC;QAC5B,CAAC,EAAE,KAAK,CAAC,CAAC;IACd,CAAC;IACD,2BAA2B,EAAE,UAAS,MAAM;QACxC,IAAG,IAAI,CAAC,eAAe,EAAC;YACpB,IAAI,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;YACxC,IAAI,YAAY,GAAG,MAAM,CAAC,QAAQ,CAAC;YACnC,IAAI,KAAK,GAAG,YAAY,CAAC,CAAC,EAAE,KAAK,GAAG,YAAY,CAAC,CAAC,EAAE,KAAK,GAAG,YAAY,CAAC,CAAC,CAAC;YAC3E,IAAI,KAAK,GAAG,YAAY,CAAC,CAAC,EAAE,KAAK,GAAG,YAAY,CAAC,CAAC,EAAE,KAAK,GAAG,YAAY,CAAC,CAAC,CAAC;YAC3E,IAAI,YAAY,GAAG,IAAI,CAAC,IAAI,CACxB,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,CAC/D,CAAC;YACF,IAAI,YAAY,GAAG,IAAI,CAAC,IAAI,CACxB,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,CAC/D,CAAC;YACF,IAAI,KAAK,GAAG,YAAY,GAAG,YAAY,CAAC;YAExC,YAAY,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,GAAC,KAAK,CAAC;YACtC,YAAY,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,GAAC,KAAK,CAAC;YACtC,YAAY,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,GAAC,KAAK,CAAC;YACtC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAC5B,IAAI,IAAI,CAAC,OAAO,CAAC,eAAe,IAAI,IAAI,CAAC,uBAAuB,EAAE;gBAE9D,IAAI,CAAC,wBAAwB,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;aACjD;YACD,IAAI,CAAC,OAAO,EAAE,CAAC;SAElB;IACL,CAAC;CACJ,CAAsB;AACR,iFAAkB,EAAC;AACN;;;;;;;;;;;;;AC7P5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+B;AACuB;AACD;AAEV;AAa3C,MAAM,QAAQ,GAAQ,0EAAM,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,sDAAY,CAAC,CAAC,IAAI,CAAC,iEAAe,CAAC,CAAC;IAEtF,WAAW,EAAE,SAAS,WAAW,CAAC,GAAG,EAAE,MAAW;QAC9C,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC;QAC/B,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QACxB,IAAI,CAAC,QAAQ,EAAE,CAAC;IACpB,CAAC;IAED,QAAQ,EAAE;QACN,IAAI,KAAK,GAAG,IAAI,CAAC;QAEjB,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;QAE/B,SAAS,UAAU,CAAC,KAAK;YACrB,IAAI,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,qBAAqB,EAAE,CAAC;YACxD,KAAK,CAAC,cAAc,CAAC,CAAC,GAAG,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC;YACnD,KAAK,CAAC,cAAc,CAAC,CAAC,GAAG,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC;YAClD,MAAM,OAAO,GAAG,IAAI,6CAAa,EAAE,CAAC;YACpC,OAAO,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAC1D,OAAO,CAAC,CAAC,GAAG,CAAE,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAC7D,MAAM,SAAS,GAAG,KAAK,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;YACrD,IAAI,SAAS,EAAE;gBACX,KAAK,CAAC,IAAI,CAAC;oBACP,IAAI,EAAE,aAAa;oBACnB,IAAI,EAAE,SAAS;iBAClB,CAAC,CAAC;aAEN;QACL,CAAC;IACL,CAAC;CACJ,CAAC,CAAC;AAII,MAAM,aAAa,GAAG,QAAyB,CAAC;AAExC,4EAAa,EAAC","file":"common-es2015.js","sourcesContent":["import createClass from '@app/_core/helpers/es5.class';\r\nimport { assignValue, isArray, isEmpty, isNumber, isObject, isString } from '@app/_core/helpers/utils';\r\n\r\n\r\nimport Scene from '../traits/scene';\r\nimport Camera from '../traits/camera';\r\nimport Renderer from '../traits/renderer';\r\nimport Controls from '../traits/controls';\r\nimport GridHelper from '../traits/grid-helper';\r\nimport Lights from '../traits/lights';\r\nimport ObjectManager from '../traits/object-manager';\r\nimport {EventDispatcher} from '../libs/event-dispatcher';\r\n\r\nimport { Geometries, LightLib, LoaderLib, Materials, Meshes } from '../libs/three.libs';\r\n\r\nimport Models from '../libs/models';\r\n\r\n\r\nimport Loader from '../modules/loader'\r\nimport Composer from '../modules/composer'\r\nimport DynamicShadows from '../modules/dynamic-shadows'\r\nimport { EngineClass, EngineInstance } from './engine.doc';\r\nimport { Floor } from '../traits/floor';\r\n\r\nexport interface EditorEngineInstance extends EngineInstance {\r\n    setData(data:any): any\r\n\r\n}\r\nexport interface EditorEngineClass extends EngineClass {\r\n    setData(data:any): any\r\n    new(data: any): EditorEngineInstance\r\n    (data:any): EditorEngineInstance\r\n}\r\n\r\n\r\nconst ClientEditorEngine = createClass(\"ClientEditorEngine\").uses(\r\n    Scene, \r\n    Camera, \r\n    Renderer, \r\n    Controls, \r\n    Models, \r\n    Lights, \r\n    ObjectManager, \r\n    Floor,\r\n    EventDispatcher, \r\n    GridHelper\r\n)({\r\n    data: {},\r\n    options: {},\r\n\r\n    Mesh: {},\r\n    Geometry: {},\r\n    Material: {},\r\n    Light: {},\r\n    Composer: {},\r\n    Shadows: {},\r\n    inited: false,\r\n    $controlEngine: null,\r\n\r\n    setData: function(data?:any){\r\n        if (data.composer && !isEmpty(data.composer)) {\r\n            this.composer = new Composer(this, data.composer);\r\n        }\r\n        if (data.lights && isArray(data.lights)) {\r\n            this.addLights(data.lights);\r\n        }\r\n        if (data.models && isArray(data.models)) {\r\n            this.addModels(data.models);\r\n        }\r\n        if (data.meshes && isArray(data.meshes)) {\r\n            this.addMeshes(data.meshes);\r\n        }\r\n        if (data.objects && (isArray(data.objects) || isObject(data.objects))) {\r\n            this.addObjects(data.objects);\r\n        }else{\r\n            this.emit(\"object.load.completed\");\r\n        }\r\n        if (data.grids && isArray(data.grids)) {\r\n            this.addGrids(data.grids);\r\n        }\r\n        if (data.cameras && isArray(data.cameras)) {\r\n            this.addCameras(data.cameras);\r\n        }\r\n        if (data.floor && isArray(data.floor)) {\r\n            this.addFloor(data.floor);\r\n        }\r\n        if (data.controls && isArray(data.controls)) {\r\n            this.addControls(data.controls);\r\n        }\r\n        this.updateSettings();\r\n        this.emit('setdata', data);\r\n        \r\n        \r\n    },\r\n\r\n    /**\r\n     * Hàm khởi tạo\r\n     * @param {Dom} viewport \r\n     * @param {*} data \r\n     */\r\n    constructor: function (data?:any) {\r\n        if (data && isObject(data)) {\r\n            this.data = data;\r\n        }\r\n        this.Geometry = Geometries;\r\n        this.Material = Materials;\r\n        this.Mesh = Meshes;\r\n        this.Light = LightLib;\r\n        this.Loader = new Loader(this);\r\n        \r\n        \r\n        var self = this;\r\n        \r\n        var focusIn = false;\r\n        this.on('pointerdown', function(e){\r\n            self.canChangeCamera = false\r\n            focusIn = true;\r\n        }, false)\r\n        document.addEventListener('pointerup', function(e){\r\n            if(focusIn){\r\n                self.canChangeCamera = true\r\n                focusIn = false;\r\n            }\r\n            \r\n        }, false);\r\n\r\n        this.on(\"object.added\", function(e){\r\n            if(isObject(self.controlEngine) && self.controlEngine.refresh){\r\n                self.controlEngine.refresh();\r\n            }\r\n        })\r\n    },\r\n\r\n    renew: function(data){\r\n        this.data = assignValue({}, data);\r\n        this.inited = false;\r\n        this.emit({\r\n            type: \"renew\"\r\n        })\r\n    },\r\n\r\n    updateSettings: function(){\r\n        if (this.data) {\r\n            var data = this.data;\r\n            if (isObject(data.scene)) {\r\n                var scene = data.scene;\r\n                this.updateSceneSettings(scene);\r\n                if (isObject(scene.background) && !isEmpty(scene.background))\r\n                    this.setBackground(scene.background);\r\n                if (isObject(scene.floor) && !isEmpty(scene.floor))\r\n                    this.updateSceneFloorSetting(scene.floor);\r\n                if (isObject(scene.size) && !isEmpty(scene.size))\r\n                    this.updateSceneSettings(scene.size);\r\n            }\r\n            if(isObject(data.shadow))\r\n                this.updateShadowSettings(data.shadow);\r\n            if(isObject(data.control))\r\n                this.updateControlSettings(data.control);\r\n            if(isObject(data.camera))\r\n                this.updateMainCameraSettings(data.camera, true);\r\n        }\r\n\r\n    },\r\n\r\n    reset: function (data_) {\r\n        if (isObject(data_)) this.data = assignValue({}, data_);\r\n        this.resetObjects();\r\n        this.resetLights();\r\n\r\n        this.updateSettings();   \r\n        this.setData(this.data);\r\n\r\n        this.emit({\r\n            type: \"reset\"\r\n        })\r\n    },\r\n\r\n\r\n    startup: function startup( data?:any) {\r\n        if (this.inited) return this;\r\n\r\n\r\n        if (data && isObject(data)) {\r\n            this.data = data;\r\n        }\r\n        this.Shadows = new DynamicShadows(this, this.data.shadow || this.data.shadows || {});\r\n        this.emit('startup', this.data);\r\n\r\n        this.initScene(this.data.scene || {});\r\n        this.setMainCamera(this.data.camera || {});\r\n        this.createRenderer(this.data.renderer || {}, this.data.shadow?this.data.shadow.enabled:true);\r\n        \r\n        this.camera.updateProjectionMatrix();\r\n        this.setMainControl(this.data.control || {});\r\n\r\n        this.updateSettings();\r\n        var self = this;\r\n        this.inited = true;\r\n        // this.Shadows.init();\r\n        self.ready();\r\n        if (!this.autoRenderStatus) {\r\n            setTimeout(function () {\r\n                self.render();\r\n            }, 500);\r\n        }\r\n    \r\n        \r\n        return this;\r\n\r\n    },\r\n    \r\n    canChangeCamera: true,\r\n\r\n    setControlEngine: function(controlEngine){\r\n        if(!isObject(controlEngine)||this.controlEngine == controlEngine) return false;\r\n        this.controlEngine = controlEngine;\r\n        controlEngine.setMainEngine(this);\r\n        var self = this;\r\n        controlEngine.on(\"controls.change.camera\", function(e){\r\n            self.changeCameraByControlEngine(e.camera);\r\n        });\r\n        controlEngine.refresh();\r\n        setTimeout(() => {\r\n            controlEngine.refresh();\r\n        }, 10000);\r\n    },\r\n    changeCameraByControlEngine: function(camera){\r\n        if(this.canChangeCamera){\r\n            var mainPosition = this.camera.position;\r\n            var ctrlPosition = camera.position;\r\n            var mainX = mainPosition.x, mainY = mainPosition.y, mainZ = mainPosition.z;\r\n            var ctrlX = ctrlPosition.x, ctrlY = ctrlPosition.y, ctrlZ = ctrlPosition.z;\r\n            var mainDistance = Math.sqrt(\r\n                Math.pow(mainX, 2) + Math.pow(mainY, 2) + Math.pow(mainZ, 2)\r\n            );\r\n            var ctrlDistance = Math.sqrt(\r\n                Math.pow(ctrlX, 2) + Math.pow(ctrlY, 2) + Math.pow(ctrlZ, 2)\r\n            );\r\n            var ratio = mainDistance / ctrlDistance;\r\n            \r\n            mainPosition.x = ctrlPosition.x*ratio;\r\n            mainPosition.y = ctrlPosition.y*ratio;\r\n            mainPosition.z = ctrlPosition.z*ratio;\r\n            this.camera.lookAt(0, 0, 0);\r\n            if (this.control.highPerformance && this.controlCanTurnOffShadow) {\r\n                \r\n                this.startDeactiveShadowTimer(500, \"control\");\r\n            }\r\n            this.refresh();\r\n\r\n        }\r\n    }\r\n}) as EditorEngineClass\r\nexport default ClientEditorEngine;\r\nexport {ClientEditorEngine};\r\n","import { getTimeStamp } from '@app/_core/helpers/utils';\r\nimport * as THREE from 'three';\r\nimport { _class } from '@app/_core/helpers/es5.class';\r\nimport { EventDispatcher } from './event-dispatcher';\r\nimport { EditorClass, iEditor } from '../store/docs';\r\nimport ClientEditor from './client-editor';\r\nimport { ItemEditorService } from '../services/item-editor.service';\r\nimport { EngineClass, EngineInstance } from '../engines/engine.doc';\r\nimport { ProjectEditorService } from '../services/project-editor.service';\r\n\r\nexport interface ProjectEditorInstance extends iEditor{\r\n    app: ProjectEditorService\r\n}\r\n\r\nexport interface ProjectEditor extends EditorClass{\r\n    new(app: ProjectEditorService, engine: EngineInstance): ProjectEditorInstance\r\n}\r\n\r\nconst Editor__: any = _class(\"ProjectEditor\").extends(ClientEditor).uses(EventDispatcher)({\r\n        \r\n    constructor: function constructor(app, engine: any) {\r\n        this.lightHelperStatus = false;\r\n        this.setup(app, engine);\r\n        this.startup2();\r\n    },\r\n\r\n    startup2: function () {\r\n        var scope = this;\r\n\r\n        this.on(\"dbclick\", onDblClick);\r\n\r\n        function onDblClick(event) {\r\n            var rect = scope.engine.wrapper.getBoundingClientRect();\r\n            scope.onDownPosition.x = event.clientX - rect.left;\r\n            scope.onDownPosition.y = event.clientY - rect.top;\r\n            const pointer = new THREE.Vector2();\r\n            pointer.x = (scope.onDownPosition.x / rect.width) * 2 - 1;\r\n            pointer.y = - (scope.onDownPosition.y / rect.height) * 2 + 1;\r\n            const detectObj = scope.selectMeshByPointer(pointer);\r\n            if (detectObj) {\r\n                scope.emit({\r\n                    type: \"select:mesh\",\r\n                    mesh: detectObj\r\n                });\r\n\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\n\r\n\r\nexport const ProjectEditor = Editor__ as ProjectEditor;\r\n\r\nexport default ProjectEditor;"],"sourceRoot":"webpack:///"}